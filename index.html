<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>LOGDAY</title>
<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  padding:20px;
  line-height:1.6;
  background:#fafafa;
  padding-bottom:90px; /* ä¸‹ãƒãƒ¼ã«éš ã‚Œãªã„ã‚ˆã†ã« */
}

h2{margin-bottom:20px;}

#nav{
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:8px;
}

.entry{
  background:#fff;
  padding:10px 12px;
  border-radius:8px;
  box-shadow:0 1px 4px rgba(0,0,0,0.06);
  margin-bottom:12px;
}

.time{color:#888;width:60px;display:inline-block;vertical-align:top;}
.text{display:block;margin-left:60px;}

#meta{margin-bottom:12px;color:#666;}
#weather{font-weight:bold;}
#dayNote{font-size:.9em;margin-top:4px;}

#ai{margin-top:40px;color:#666;font-size:.9em;}
.end{margin-top:30px;font-weight:bold;}

/* â–¼ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼ˆæœˆï¼‰ */
#calendar{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:4px;
  margin-bottom:16px;
}

#calendar button{
  padding:6px 0;
  border-radius:6px;
  border:1px solid #ccc;
  background:#fff;
  cursor:pointer;
  font-size:.85em;
}

#calendar button.active{
  background:#333;
  color:#fff;
}

#calendar.hidden{display:none;}

/* â–¼é€±ãƒãƒ¼ */
#weekBar{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:6px;
  margin:10px 0 16px;
}

#weekBar button{
  padding:8px 0;
  border-radius:10px;
  border:1px solid #ddd;
  background:#fff;
  cursor:pointer;
  font-size:.85em;
  line-height:1.1;
}

#weekBar button .d{
  display:block;
  font-size:.75em;
  color:#666;
  margin-top:2px;
}

#weekBar button.active{background:#333;color:#fff;}
#weekBar button.active .d{color:#fff;opacity:.85;}

/* â–¼è¡¨ç¤ºåˆ‡æ›¿ */
#viewToggle{
  margin-left:auto;
  display:flex;
  gap:4px;
}

#viewToggle button{
  padding:4px 10px;
  border-radius:999px;
  border:1px solid #ccc;
  background:#fff;
  cursor:pointer;
  font-size:.85em;
}

#viewToggle button.active{background:#333;color:#fff;}

/* â–¼å…¥åŠ›ã‚¨ãƒªã‚¢ï¼ˆæ—§ï¼‰ */
#inputArea{display:flex;gap:8px;margin-bottom:16px;}
#inputArea input{padding:6px;border-radius:6px;border:1px solid #ccc;}
#inputArea button{padding:6px 10px;border-radius:6px;border:none;background:#333;color:#fff;cursor:pointer;}

/* â–¼ãƒ•ãƒªãƒ¼ã‚¹ãƒšãƒ¼ã‚¹ */
#notesArea{margin-top:20px;}
#notesArea textarea{
  width:100%;
  min-height:120px;
  padding:8px;
  border-radius:6px;
  border:1px solid #ccc;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
}
#notesArea button{
  margin-top:8px;
  padding:6px 10px;
  border-radius:6px;
  border:none;
  background:#333;
  color:#fff;
  cursor:pointer;
}

/* â–¼å†™çœŸã‚¨ãƒªã‚¢ */
#photoArea{margin:12px 0 20px;}
#photoPlaceholder{
  width:100%;
  height:180px;
  background:#eaeaea;
  border-radius:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#666;
  font-size:16px;
  cursor:pointer;
}

/* â–¼ä¸‹ã‹ã‚‰å‡ºã‚‹å…¥åŠ›ãƒãƒ¼ï¼ˆLINEé¢¨ï¼‰ */
#inputBar{
  position:fixed;
  left:0; right:0; bottom:0;
  background:#fff;
  border-top:1px solid #ddd;
  padding:10px 12px;
  display:flex;
  gap:8px;
  z-index:9999;
  align-items:flex-end;
  transition:padding .25s ease;
  max-height:220px;
}

#actionBar{
  display:flex;
  gap:6px;
  align-items:center;
}

.iconBtn{
  width:34px;height:34px;
  border-radius:10px;
  border:1px solid #ddd;
  background:#fff;
  cursor:pointer;
  font-size:16px;
  line-height:1;
  display:inline-flex;
  align-items:center;
  justify-content:center;
}

.iconBtn:active{transform:translateY(1px);}

#logInput{
  flex:1;
  height:36px;
  resize:none;
  border-radius:10px;
  border:1px solid #ccc;
  padding:8px 10px;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  width:100%;
  box-sizing:border-box;
  outline:none;
  transition:height .25s ease;
}

#saveBtn{
  padding:0 14px;
  height:34px;
  border-radius:10px;
  border:none;
  background:#333;
  color:#fff;
  cursor:pointer;
}

/* é–‹ã„ãŸçŠ¶æ…‹ï¼ˆã«ã‚…ã£ã¨ä¼¸ã³ã‚‹ï¼‰ */
#inputBar.expanded{padding:12px;box-shadow:0 -8px 20px rgba(0,0,0,0.12);}
#inputBar.expanded #logInput{height:120px;}

/* file input ã¯UIã‚’å‡ºã•ãšã€æ©Ÿèƒ½ã ã‘æ®‹ã™ï¼ˆiOSã§label forã§é–‹ãï¼‰ */
.fileInput{
  position:fixed;
  top:-10000px;
  left:-10000px;
  width:0;height:0;
  opacity:0;
  pointer-events:none;
}
</style>
</head>
<body>

<div id="nav">
  <button id="prev">â†</button>
  <button id="today">ä»Šæ—¥</button>
  <button id="next">â†’</button>

  <div id="viewToggle">
    <button id="weekBtn" class="active">é€±</button>
    <button id="monthBtn">æœˆ</button>
  </div>
</div>

<!-- æœˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
<div id="calendar" class="hidden"></div>

<!-- é€±ãƒãƒ¼ -->
<div id="weekBar"></div>

<h2 id="dateHeader">
  <span id="currentDate"></span>
  <span id="currentWeekday"></span>
</h2>

<div id="photoArea">
  <div id="photoPlaceholder">ï¼‹ å†™çœŸã‚’è¿½åŠ </div>
</div>

<div id="meta">
  <span id="weather"></span>
  <div id="dayNote"></div>
</div>

<div id="inputArea">
  <input id="timeInput" type="time">
  <input id="textInput" type="text" placeholder="ã„ã¾ä½•ã—ã¦ã‚‹ï¼Ÿ">
  <button id="addEntry">è¿½åŠ </button>
</div>

<div id="entries"></div>

<div id="notesArea">
  <textarea id="notesInput" placeholder="ã“ã®æ—¥ã®å‚™è€ƒãƒ»æ„Ÿæƒ³ãªã©ã€æ™‚é–“è»¸é–¢ä¿‚ãªãè‡ªç”±ã«æ›¸ã‘ã¾ã™"></textarea>
  <button id="saveNotes">ä¿å­˜</button>
</div>

<div id="ai"></div>
<div id="endNote" class="end"></div>

<!-- â–¼ä¸‹ã‹ã‚‰å‡ºã‚‹å…¥åŠ›ãƒãƒ¼ -->
<div id="inputBar">
  <div id="actionBar">
    <button class="iconBtn" id="plusBtn" type="button" title="è¿½åŠ ">ï¼‹</button>
    <label class="iconBtn" for="takePhotoInput" title="ã‚«ãƒ¡ãƒ©" role="button">ğŸ“·</label>
    <label class="iconBtn" for="pickPhotoInput" title="å†™çœŸ" role="button">ğŸ–¼ï¸</label>
  </div>

  <textarea id="logInput" placeholder="ä»Šæ—¥ã®ã²ã¨ã“ã¨â€¦"></textarea>
  <button id="saveBtn" type="button">ä¿å­˜</button>

  <input id="pickPhotoInput" class="fileInput" type="file" accept="image/*">
  <input id="takePhotoInput" class="fileInput" type="file" accept="image/*" capture="environment">
</div>

<script>
/* =========================
   state
========================= */
let viewMode = 'week'; // 'week' or 'month'
let currentDate = new Date().toISOString().slice(0,10);

/* =========================
   helpers
========================= */
function renderDateHeader(dateStr){
  const d = new Date(dateStr);
  const dateText = d.toLocaleDateString('ja-JP',{year:'numeric',month:'2-digit',day:'2-digit'});
  const weekdayText = d.toLocaleDateString('ja-JP',{weekday:'short'});
  document.getElementById('currentDate').textContent = dateText;
  document.getElementById('currentWeekday').textContent = `ï¼ˆ${weekdayText}ï¼‰`;
}

function formatYMD(d){ return d.toISOString().slice(0,10); }

function startOfWeek(dateStr){
  const d = new Date(dateStr);
  const day = d.getDay(); // 0=æ—¥
  const diff = (day === 0) ? -6 : (1 - day); // æœˆæ›œå§‹ã¾ã‚Š
  d.setDate(d.getDate() + diff);
  return d;
}

function shiftByView(dateStr, diff){
  const d = new Date(dateStr);
  if (viewMode === 'month'){
    d.setDate(1);
    d.setMonth(d.getMonth() + diff);
  } else {
    d.setDate(d.getDate() + diff);
  }
  return formatYMD(d);
}

/* =========================
   render: week bar
========================= */
function renderWeekBar(dateStr){
  const bar = document.getElementById('weekBar');
  bar.style.display = (viewMode === 'week') ? 'grid' : 'none';
  if (viewMode !== 'week') return;

  bar.innerHTML = '';
  const start = startOfWeek(dateStr);
  const wnames = ['æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ','æ—¥'];

  for(let i=0;i<7;i++){
    const d = new Date(start);
    d.setDate(start.getDate() + i);
    const ymd = formatYMD(d);

    const btn = document.createElement('button');
    btn.dataset.date = ymd;
    btn.innerHTML = `${wnames[i]}<span class="d">${d.getDate()}</span>`;
    btn.classList.toggle('active', ymd === currentDate);

    btn.onclick = () => {
      currentDate = ymd;
      loadDay(currentDate);
      renderWeekBar(currentDate);
    };

    bar.appendChild(btn);
  }
}

/* =========================
   render: month calendar
========================= */
function generateCalendar(){
  const cal = document.getElementById('calendar');
  cal.innerHTML = '';

  const d = new Date(currentDate);
  const year = d.getFullYear();
  const month = d.getMonth();
  const firstDay = new Date(year, month, 1);
  const lastDate = new Date(year, month + 1, 0).getDate();
  const startWeekday = firstDay.getDay(); // 0=æ—¥

  // ç©ºç™½ï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®é ­åˆã‚ã›ï¼‰
  for(let i=0;i<startWeekday;i++){
    const empty = document.createElement('button');
    empty.disabled = true;
    empty.style.visibility = 'hidden';
    cal.appendChild(empty);
  }

  for(let day=1; day<=lastDate; day++){
    const dayStr = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
    const btn = document.createElement('button');
    btn.textContent = day;
    btn.dataset.date = dayStr;
    btn.classList.toggle('active', dayStr === currentDate);

    btn.onclick = () => {
      currentDate = dayStr;
      // æœˆè¡¨ç¤ºä¸­ã¯ãƒ˜ãƒƒãƒ€ãƒ¼ã ã‘æ›´æ–°ã—ã¦ãŠã
      renderDateHeader(currentDate);
      generateCalendar();
    };

    cal.appendChild(btn);
  }
}

/* =========================
   render: day
========================= */
function loadDay(dateStr){
  renderDateHeader(dateStr);

  const entriesDiv = document.getElementById('entries');
  entriesDiv.innerHTML = '';

  const saved = JSON.parse(localStorage.getItem(dateStr) || '{}');

  if(saved.entries && saved.entries.length){
    saved.entries.forEach(entry=>{
      const div = document.createElement('div');
      div.className = 'entry';

      const time = document.createElement('span');
      time.className = 'time';
      time.textContent = entry.time || 'â€¢';

      const text = document.createElement('span');
      text.className = 'text';
      text.textContent = entry.text || '';

      div.appendChild(time);
      div.appendChild(text);
      entriesDiv.appendChild(div);
    });
  } else {
    entriesDiv.innerHTML = '<div style="color:#888;">ã“ã®æ—¥ã¯ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</div>';
  }

  document.getElementById('notesInput').value = saved.notes || '';
}

function loadMonth(dateStr){
  renderDateHeader(dateStr);
  // æœˆãƒ¢ãƒ¼ãƒ‰ã®ä¸­èº«ã¯ä»Šã¯ä»®ï¼ˆå¿…è¦ãªã‚‰ã“ã“ã§æœˆã¾ã¨ã‚ã‚’å‡ºã™ï¼‰
  const entriesDiv = document.getElementById('entries');
  entriesDiv.innerHTML = '<p style="color:#888;">ğŸ“… æœˆè¡¨ç¤ºï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰æ—¥ä»˜é¸æŠï¼‰</p>';
}

/* =========================
   view switch (ONLY ONE SET)
========================= */
const weekBtn = document.getElementById('weekBtn');
const monthBtn = document.getElementById('monthBtn');
const calEl = document.getElementById('calendar');

function showWeek(){
  viewMode = 'week';
  weekBtn.classList.add('active');
  monthBtn.classList.remove('active');

  calEl.classList.add('hidden');

  renderWeekBar(currentDate);
  loadDay(currentDate);
}

function showMonth(){
  viewMode = 'month';
  monthBtn.classList.add('active');
  weekBtn.classList.remove('active');

  calEl.classList.remove('hidden');

  generateCalendar();
  loadMonth(currentDate);
}

// iPhoneå¯¾ç­–ï¼šclick + touchendï¼ˆtouchstartã¯äºŒé‡ç™ºç«ã—ãŒã¡ï¼‰
['click','touchend'].forEach(evt => {
  weekBtn.addEventListener(evt, e => { e.preventDefault(); showWeek(); }, {passive:false});
  monthBtn.addEventListener(evt, e => { e.preventDefault(); showMonth(); }, {passive:false});
});

/* =========================
   nav arrows
========================= */
document.getElementById('prev').onclick = () => {
  currentDate = shiftByView(currentDate, -1);
  if (viewMode === 'month') generateCalendar();
  (viewMode === 'month') ? loadMonth(currentDate) : loadDay(currentDate);
  renderWeekBar(currentDate);
};

document.getElementById('next').onclick = () => {
  currentDate = shiftByView(currentDate, 1);
  if (viewMode === 'month') generateCalendar();
  (viewMode === 'month') ? loadMonth(currentDate) : loadDay(currentDate);
  renderWeekBar(currentDate);
};

document.getElementById('today').onclick = () => {
  currentDate = new Date().toISOString().slice(0,10);
  if (viewMode === 'month') generateCalendar();
  (viewMode === 'month') ? loadMonth(currentDate) : loadDay(currentDate);
  renderWeekBar(currentDate);
};

/* =========================
   add entry (old inputArea)
========================= */
document.getElementById('addEntry').onclick = () => {
  const time = document.getElementById('timeInput').value;
  const text = document.getElementById('textInput').value.trim();
  if(!text) return;

  const dayData = JSON.parse(localStorage.getItem(currentDate) || '{}');
  dayData.entries = dayData.entries || [];
  dayData.entries.push({time: time || 'â€¢', text});
  localStorage.setItem(currentDate, JSON.stringify(dayData));

  loadDay(currentDate);

  document.getElementById('timeInput').value = '';
  document.getElementById('textInput').value = '';
};

/* =========================
   notes save
========================= */
document.getElementById('saveNotes').onclick = () => {
  const notes = document.getElementById('notesInput').value;
  const dayData = JSON.parse(localStorage.getItem(currentDate) || '{}');
  dayData.notes = notes;
  localStorage.setItem(currentDate, JSON.stringify(dayData));
  alert('ä¿å­˜ã—ã¾ã—ãŸï¼');
};

/* =========================
   bottom bar behavior
========================= */
const inputBar = document.getElementById('inputBar');
const logInput = document.getElementById('logInput');
const saveBtn  = document.getElementById('saveBtn');

logInput.addEventListener('focus', () => inputBar.classList.add('expanded'));
logInput.addEventListener('blur',  () => inputBar.classList.remove('expanded'));

saveBtn.addEventListener('click', () => {
  const text = logInput.value.trim();
  if(!text) return;

  const dayData = JSON.parse(localStorage.getItem(currentDate) || '{}');
  dayData.notes = (dayData.notes || '');
  dayData.notes += (dayData.notes ? '\n' : '') + text;
  localStorage.setItem(currentDate, JSON.stringify(dayData));

  document.getElementById('notesInput').value = dayData.notes;

  logInput.value = '';
  inputBar.classList.remove('expanded');
  logInput.blur();
});

/* =========================
   plus + photo/camera
========================= */
document.getElementById('plusBtn').addEventListener('click', () => {
  alert('ï¼‹ï¼šå°†æ¥çš„ã« ä½ç½®æƒ…å ± / ãƒ•ã‚¡ã‚¤ãƒ« / ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ ã‚’å…¥ã‚Œã‚‹äºˆå®š');
});

const pickPhotoInput = document.getElementById('pickPhotoInput');
const takePhotoInput = document.getElementById('takePhotoInput');

function handlePickedImage(file){
  if(!file) return;

  const placeholder = document.getElementById('photoPlaceholder');
  const url = URL.createObjectURL(file);

  placeholder.innerHTML = '';
  placeholder.style.backgroundImage = `url(${url})`;
  placeholder.style.backgroundSize = 'cover';
  placeholder.style.backgroundPosition = 'center';
  placeholder.style.color = 'transparent';

  inputBar.classList.add('expanded');
  logInput.focus();
}

[pickPhotoInput, takePhotoInput].forEach(inp => {
  inp.addEventListener('change', (e) => {
    handlePickedImage(e.target.files && e.target.files[0]);
    e.target.value = '';
  });
});

/* =========================
   init
========================= */
generateCalendar(); // æœˆã®ãŸã‚ã«ç”¨æ„
showWeek();         // åˆæœŸã¯é€±
</script>

<button id="exportLogday" style="margin-top:12px">
  å…¨ãƒ­ã‚°ã‚’JSONã§ä¿å­˜
</button>

<script>
document.getElementById("exportLogday").onclick = () => {
  const out = {};
  for (const k of Object.keys(localStorage)) {
    if (/^\d{4}-\d{2}-\d{2}$/.test(k)) {
      out[k] = JSON.parse(localStorage.getItem(k));
    }
  }

  const blob = new Blob(
    [JSON.stringify(out, null, 2)],
    { type: "application/json" }
  );

  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = `logday-backup-${new Date().toISOString().slice(0,10)}.json`;
  a.click();
};
</script>

<button id="importLogday" style="margin-top:8px">
  JSONã‚’èª­ã¿è¾¼ã‚“ã§å¾©å…ƒ
</button>
<input id="importFile" type="file" accept="application/json" style="display:none" />

<script>
  // import ã®å‡¦ç†
</script>

</body>
</html>
